# ================================
# Helm Values for Nexus LMS
# Production Configuration
# ================================

# Global settings
global:
  environment: production
  domain: nexus-lms.example.com
  imageRegistry: ${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com

# Server configuration
server:
  replicaCount: 3
  image:
    repository: nexus-lms-server
    tag: latest
    pullPolicy: Always
  
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
  
  env:
    NODE_ENV: production
    PORT: "3000"
    LOG_LEVEL: info
  
  secrets:
    existingSecret: nexus-lms-secrets
  
  service:
    type: ClusterIP
    port: 3000
  
  probes:
    liveness:
      path: /api/health
      initialDelaySeconds: 30
      periodSeconds: 10
    readiness:
      path: /api/health
      initialDelaySeconds: 10
      periodSeconds: 5

# Client configuration
client:
  replicaCount: 2
  image:
    repository: nexus-lms-client
    tag: latest
    pullPolicy: Always
  
  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "100m"
  
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70
  
  service:
    type: ClusterIP
    port: 80
  
  probes:
    liveness:
      path: /health
      initialDelaySeconds: 10
      periodSeconds: 10
    readiness:
      path: /health
      initialDelaySeconds: 5
      periodSeconds: 5

# Ingress configuration
ingress:
  enabled: true
  className: alb
  annotations:
    kubernetes.io/ingress.class: alb
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
    alb.ingress.kubernetes.io/ssl-redirect: "443"
  hosts:
    - host: nexus-lms.example.com
      paths:
        - path: /api
          pathType: Prefix
          service: server
        - path: /
          pathType: Prefix
          service: client
  tls:
    - hosts:
        - nexus-lms.example.com
      secretName: nexus-lms-tls

# Pod Disruption Budget
podDisruptionBudget:
  server:
    minAvailable: 2
  client:
    minAvailable: 1

# Service Account
serviceAccount:
  create: true
  name: nexus-lms-sa
  annotations:
    eks.amazonaws.com/role-arn: ${IAM_ROLE_ARN}

# Network Policies
networkPolicy:
  enabled: true
